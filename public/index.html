<!DOCTYPE html>
<html>

<head>
  <title>Ping Pong Game | TAM</title>
</head>

<body style="padding: 0; margin: 0; height: 100vh;">
  <canvas id="canvas" width="800" height="400"></canvas>
  <script type="text/javascript" src="js/app.js"></script>
  <script type="text/javascript">

    app.onInit = function () {
      // Calculate the initial bounds
      this.calculateBounds()

      // Add a player and create a reference variable
      this.nodes.push({
        id: 'player-left',
        x: this.leftBound,
        y: this.centerY - this.playerHeight / 2,
        width: this.playerWidth,
        height: this.playerHeight,
        dy: 0,
        color: '#581845'
      });

      this.playerLeft = this.getNode("player-left")

      // Add a player and create a reference variable
      this.nodes.push({
        id: 'player-right',
        x: this.rightBound,
        y: this.centerY - this.playerHeight / 2,
        width: this.playerWidth,
        height: this.playerHeight,
        dy: 0,
        color: '#581845',
      });

      this.playerRight = this.getNode("player-right")

      // Add a ball and create a reference variable
      this.nodes.push({
        id: "ball",
        x: this.centerX - this.ballSide / 2,
        y: this.centerY - this.ballSide / 2,
        width: this.ballSide,
        height: this.ballSide,
        color: '#FF5733'
      })

      this.ball = this.getNode("ball")
    };

    app.onUpdate = function (time) {
      // TODO#1: Make the game cover the whole browser
      this.canvas.width = this.width
      this.canvas.height = this.height

      if (this.playerLeft) this.playerLeft.y += this.playerLeft.dy
      else console.log(`Loading player 1.`);

      if (this.playerRight) this.playerRight.y += this.playerRight.dy
      else console.log(`Loading player 2`);


    };

    // Calculate and save values for positions, bounds, width, height, and side
    app.calculateBounds = function () {
      // Save the existing width and height
      this.previousWidth = this.width
      this.previousHeight = this.height

      // update the width and height to match the window
      this.width = window.innerWidth
      this.height = window.innerHeight

      // Calculate the measurements of player and ball
      this.playerWidth = this.width / 80
      this.playerHeight = this.height / 5
      this.ballSide = this.width / 100

      // calculate the position for center and boundary
      this.centerX = this.width / 2
      this.centerY = this.height / 2
      this.rightBound = this.width - this.playerWidth * 2
      this.leftBound = this.playerWidth * 2
      this.topBound = 0
      this.bottomBound = this.height - this.playerHeight
    }

    // Handle the key press event
    function keyDownHandler(e) {
      if (e.keyCode == 38 || e.which == 38) {
        app.playerRight.dy = -5
      }
      if (e.keyCode == 40 || e.which == 40)
        app.playerRight.dy = 5

      if (e.keyCode == 87 || e.which == 87) {
        app.playerLeft.dy = -5
      }
      if (e.keyCode == 83 || e.which == 83) {
        app.playerLeft.dy = 5
      }
    }

    // Handle key release
    function keyUpHandler(e) {
      if (e.keyCode == 38 || e.which == 38 || e.keyCode == 40 || e.which == 40) {
        app.playerRight.dy = 0
      }
      if (e.keyCode == 87 || e.which == 87 || e.keyCode == 83 || e.which == 83) {
        app.playerLeft.dy = 0
      }
    }
    // Listen for keydown events and call the keyDownHandler
    document.addEventListener("keydown", keyDownHandler, false)
    document.addEventListener("keyup", keyUpHandler, false)

  </script>
</body>

</html>